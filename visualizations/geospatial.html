

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Geospatial Plots &#8212; IDP at NCHS</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script kind="utterances">

    var commentsRunWhenDOMLoaded = cb => {
    if (document.readyState != 'loading') {
        cb()
    } else if (document.addEventListener) {
        document.addEventListener('DOMContentLoaded', cb)
    } else {
        document.attachEvent('onreadystatechange', function() {
        if (document.readyState == 'complete') cb()
        })
    }
}

var addUtterances = () => {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src = "https://utteranc.es/client.js";
    script.async = "async";

    script.setAttribute("repo", "jeffstride/idp");
    script.setAttribute("issue-term", "pathname");
    script.setAttribute("theme", "preferred-color-scheme");
    script.setAttribute("label", "üí¨ Comments");
    script.setAttribute("crossorigin", "anonymous");

    sections = document.querySelectorAll("div.section");
    if (sections !== null) {
        section = sections[sections.length-1];
        section.appendChild(script);
    }
}
commentsRunWhenDOMLoaded(addUtterances);
</script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-DW6SHVPBYV"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-DW6SHVPBYV');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'visualizations/geospatial';</script>
    <link rel="shortcut icon" href="../_static/favicon.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Line Plots &amp; Scatter Plots" href="lineplots.html" />
    <link rel="prev" title="Bar Charts" href="barchart.html" />
    
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-DW6SHVPBYV"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-DW6SHVPBYV');
    </script>


  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../_static/logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../index.html">
                    <i class="fas fa-hand-sparkles fa-fw"></i> Introduction
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../homework-assignments/index.html"><i class="fas fa-book fa-fw"></i> Homework Assignments</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../homework-assignments/hw1.html"><i class="fas fa-laptop fa-fw"></i> HW1 - Startup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../homework-assignments/hw2.html"><i class="fas fa-laptop fa-fw"></i> HW2 - Primer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../homework-assignments/hw3.html"><i class="fas fa-laptop fa-fw"></i> HW3 - Pok√©mon</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../module-additions/index.html"><i class="fas fa-layer-group fa-fw"></i> Module Additions</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../module-additions/module1/index.html"><i class="fas fa-book fa-fw"></i> Module 1 : Introduction</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../module-additions/module1/building-in-replit.html">Building in Replit</a></li>
<li class="toctree-l3"><a class="reference internal" href="../module-additions/module1/replit-tips.html">Replit Tips</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../module-additions/module2/index.html"><i class="fas fa-book fa-fw"></i> Module 2</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../module-additions/module2/stub1.html">Stub 1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../module-additions/module2/stub2.html">Stub 2</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../module-additions/module3/index.html"><i class="fas fa-book fa-fw"></i> Module 3</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../module-additions/module3/printing.html">Arguments</a></li>

</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../final-project/index.html"><i class="fas fa-layer-group fa-fw"></i> Final Project</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../final-project/handouts/index.html"><i class="fas fa-book fa-fw"></i> Final Project - Handouts</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-7"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../final-project/handouts/proposal.html">Proposal Document</a></li>
<li class="toctree-l3"><a class="reference internal" href="../final-project/handouts/code.html">Final Project Code</a></li>
<li class="toctree-l3"><a class="reference internal" href="../final-project/handouts/report.html">Final Report</a></li>
<li class="toctree-l3"><a class="reference internal" href="../final-project/handouts/presentation.html">Final Presentation</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../final-project/tips/index.html"><i class="fas fa-book fa-fw"></i> Final Project - Tips</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-8"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../final-project/tips/proposal.html">Tips for Proposal Document</a></li>
<li class="toctree-l3"><a class="reference internal" href="../final-project/tips/code.html">Tips for Final Project Code</a></li>
<li class="toctree-l3"><a class="reference internal" href="../final-project/tips/report.html">Tips for Final Report</a></li>
<li class="toctree-l3"><a class="reference internal" href="../final-project/tips/presentation.html">Tips for Final Presentation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="index.html"><i class="fas fa-book fa-fw"></i> Visualizations</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-9"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="barchart.html">Bar Charts</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Geospatial Plots</a></li>
<li class="toctree-l2"><a class="reference internal" href="lineplots.html">Line Plots &amp; Scatter Plots</a></li>
<li class="toctree-l2"><a class="reference internal" href="line_of_best_fit.html">Curve of Best Fit</a></li>

<li class="toctree-l2"><a class="reference internal" href="case_study_dist.html">Case Study on Distance</a></li>

</ul>
</li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/jeffstride/idp" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/jeffstride/idp/edit/main/book_source/visualizations/geospatial.md" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/jeffstride/idp/issues/new?title=Issue%20on%20page%20%2Fvisualizations/geospatial.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/visualizations/geospatial.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Geospatial Plots</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#contiguous-states-only">Contiguous States Only</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#inset-alaska-hawaii">Inset Alaska &amp; Hawaii</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modified-geometry">Modified Geometry</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#annotated-with-table-inset">Annotated with Table Inset</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#finding-obvious-correlations">Finding Obvious Correlations</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#correlations-and-coefficient-of-determination">Correlations and Coefficient of Determination</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#cartopy">Cartopy</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="geospatial-plots">
<h1>Geospatial Plots<a class="headerlink" href="#geospatial-plots" title="Permalink to this heading">#</a></h1>
<p>Geospatial plots are great at:</p>
<ol class="arabic simple">
<li><p>Showing how an <strong>area</strong> is impacted relative to other <strong>areas.</strong></p></li>
<li><p>Revealing which area is impacted.</p></li>
<li><p>Illustrateing a pattern in the location of something.</p></li>
</ol>
<p>Geospatial plots are NOT good at:</p>
<ol class="arabic simple">
<li><p>Showing <strong>how</strong> one value correlates to another. (Use a line plot for this)</p></li>
<li><p>Emphasizing the amount of difference between one area and another.</p></li>
</ol>
<section id="contiguous-states-only">
<h2>Contiguous States Only<a class="headerlink" href="#contiguous-states-only" title="Permalink to this heading">#</a></h2>
<p>Let‚Äôs start off by showing the benefits of showing only the contiguous United States.
Imagine that we are trying to show which states have the most electoral college votes
and perhaps we want to emphasize that California has the most by a long shot.</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-0" name="sd-tab-set-0" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-0">
Image</label><div class="sd-tab-content docutils">
<p>One the left, we see what many students show‚Äìthe full 50 states.<br />
One the right, is a much improved image showing only the 48 contiguous states.<br />
<img alt="election image" src="../_images/geo_demo_clip.jpg" /></p>
</div>
<input id="sd-tab-item-1" name="sd-tab-set-0" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-1">
Code</label><div class="sd-tab-content docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>

<span class="c1"># Left Side: Plot the entire United States</span>
<span class="n">gdf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="s1">&#39;Electoral Votes&#39;</span><span class="p">)</span>

<span class="c1"># Right Side: Plot the contiguous US with a legend</span>
<span class="n">gdf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="s1">&#39;Electoral Votes&#39;</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span> <span class="c1"># remove the box and the x,y ticks</span>

<span class="c1"># Set the extent of the axes to cut off Alaska and Hawaii</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">130</span><span class="p">,</span> <span class="o">-</span><span class="mi">65</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-2" name="sd-tab-set-0" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-2">
Data</label><div class="sd-tab-content docutils">
<p>This data is a merge of two different data sources: electoral_college.csv and a ShapeFile of the United States.  You‚Äôll note that in the code we were able to read column values <code class="docutils literal notranslate"><span class="pre">&quot;707,558&quot;</span></code> (a string with a literal comma as the thousands separator), by using the named parameter <code class="docutils literal notranslate"><span class="pre">thousands</span></code> in the <code class="docutils literal notranslate"><span class="pre">read_csv</span></code> call. Handy!! We also eliminated a duplicate column using <code class="docutils literal notranslate"><span class="pre">drop</span></code>.<br />
<img alt="election data" src="../_images/geo_elect_data.jpg" /></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">electoral</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;electoral_college.csv&#39;</span><span class="p">,</span> <span class="n">thousands</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
<span class="n">gdf</span> <span class="o">=</span> <span class="n">us_states</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">electoral</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;NAME&#39;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;State&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
<span class="n">gdf</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s1">&#39;State&#39;</span><span class="p">)</span> <span class="c1"># this is a duplicate of &#39;NAME&#39;</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-3" name="sd-tab-set-0" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-3">
Comments</label><div class="sd-tab-content docutils">
<p>In this example, we have two geospatial in one figure where there are just three differences.</p>
<ol class="arabic simple">
<li><p>The box and ticks are hidden</p></li>
<li><p>We clip off Alaska &amp; Hawaii</p></li>
<li><p>We show a legend</p></li>
</ol>
<p>By hiding Alaska and Hawaii, we can bring a much greater focus on the states. Providing a legend is very helpful. And, eliminating the box with longitude and latitude ticks removes an unnecessary distraction since we really don‚Äôt care about the lat/long.</p>
<p>In the chart on the right, we can easily see that California is large and brilliant yellow which ephasizes its impact.
There are two ways to hide these states. One way is to eliminate them from the GeoDataFrame:<br />
<code class="docutils literal notranslate"><span class="pre">gdf</span> <span class="pre">=</span> <span class="pre">gdf[(gdf['NAME']</span> <span class="pre">!=</span> <span class="pre">'Alaska')</span> <span class="pre">&amp;</span> <span class="pre">(gdf['NAME']</span> <span class="pre">!=</span> <span class="pre">'Hawaii')]</span></code><br />
Another way is to set some limits on the x &amp; y axes: <code class="docutils literal notranslate"><span class="pre">ax2.set_xlim(-130,</span> <span class="pre">-65)</span></code></p>
</div>
</div>
</section>
<section id="inset-alaska-hawaii">
<h2>Inset Alaska &amp; Hawaii<a class="headerlink" href="#inset-alaska-hawaii" title="Permalink to this heading">#</a></h2>
<p>Eliminating two states from the drawing isn‚Äôt so great. We‚Äôd like to show Alaska and Hawaii like other maps do using an <code class="docutils literal notranslate"><span class="pre">inset</span></code>. This can be done, but it does get complicated rather quickly. The inset is a separate plot with separate arguments. When legends are shown, the size of the figure changes and the placement of the inset changes. I provide this code because it is educational to see and play with, but I recommend the method below this.</p>
<div class="dropdown admonition">
<p class="admonition-title">Inset Image and Complicated Code</p>
<p><img alt="election image" src="../_images/geo_inset_no_borders.jpg" /></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">draw_us_inset</span><span class="p">(</span><span class="n">gdf</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">):</span>
    <span class="c1"># Create a new figure and axes for the main plot</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>

    <span class="c1"># Plot the entire United States</span>
    <span class="n">gdf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">)</span>

    <span class="c1"># Set the extent of the main plot to cut off Alaska &amp; Hawaii</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">130</span><span class="p">,</span> <span class="o">-</span><span class="mi">65</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">23</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>

    <span class="c1"># helper method to plot both insets without a border, no legend, correct vmin/vmax</span>
    <span class="k">def</span> <span class="nf">inset</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        position = a list: [x, y, width, height] in % of figure size</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">gdf</span><span class="p">[</span><span class="n">gdf</span><span class="p">[</span><span class="s1">&#39;NAME&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">name</span><span class="p">]</span>
        <span class="n">args_no_legend</span> <span class="o">=</span> <span class="n">args</span>
        <span class="n">args_no_legend</span><span class="p">[</span><span class="s1">&#39;legend&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># The new plot for the inset needs to have the vmin/vmax set to the same</span>
        <span class="c1"># values as the main plot so the colors show correctly</span>
        <span class="k">if</span> <span class="s1">&#39;column&#39;</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
            <span class="n">args_no_legend</span><span class="p">[</span><span class="s1">&#39;vmin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf</span><span class="p">[</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;column&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
            <span class="n">args_no_legend</span><span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf</span><span class="p">[</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;column&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
            
        <span class="n">state</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="o">**</span><span class="n">args_no_legend</span><span class="p">)</span>
        
        <span class="c1"># remove box around inset in 1-line comprehension</span>
        <span class="p">[</span> <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="n">side</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span> <span class="k">for</span> <span class="n">side</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="s1">&#39;right&#39;</span><span class="p">]</span> <span class="p">]</span>
        
        <span class="c1"># clip our inset if needed</span>
        <span class="k">if</span> <span class="n">xlim</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>

    <span class="n">inset</span><span class="p">([</span><span class="mf">0.20</span><span class="p">,</span> <span class="mf">0.20</span><span class="p">,</span> <span class="mf">0.20</span><span class="p">,</span> <span class="mf">0.20</span><span class="p">],</span> <span class="s1">&#39;Alaska&#39;</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="o">-</span><span class="mi">130</span><span class="p">))</span>
    <span class="n">inset</span><span class="p">([</span><span class="mf">0.37</span><span class="p">,</span> <span class="mf">0.19</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">],</span> <span class="s1">&#39;Hawaii&#39;</span><span class="p">)</span>

<span class="n">draw_us_inset</span><span class="p">(</span><span class="n">gdf</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="s1">&#39;Electoral Votes&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="modified-geometry">
<h2>Modified Geometry<a class="headerlink" href="#modified-geometry" title="Permalink to this heading">#</a></h2>
<p>It becomes much easier to deal with plotting the full United States if the GeoDataFrame‚Äôs geometry is modified to put Alaska and Hawaii in the ‚Äúright‚Äù spot. The only drawbacks are:</p>
<ul class="simple">
<li><p>If you do geospatial <code class="docutils literal notranslate"><span class="pre">sjoin</span></code>s, then it‚Äôll all get messed up geographically.</p></li>
<li><p>If you want to illustrate something on the Pacific Ocean, there are states in the way!</p></li>
</ul>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-4" name="sd-tab-set-1" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-4">
Image</label><div class="sd-tab-content docutils">
<p><img alt="election image" src="../_images/geo_elect.jpg" /></p>
</div>
<input id="sd-tab-item-5" name="sd-tab-set-1" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-5">
Code</label><div class="sd-tab-content docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">shapely.affinity</span> <span class="kn">import</span> <span class="n">translate</span>
<span class="kn">from</span> <span class="nn">shapely.affinity</span> <span class="kn">import</span> <span class="n">scale</span>
<span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="kn">import</span> <span class="n">MultiPolygon</span>

<span class="k">def</span> <span class="nf">modify_geometry</span><span class="p">(</span><span class="n">gdf</span><span class="p">,</span> <span class="n">name_col</span><span class="o">=</span><span class="s1">&#39;NAME&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Changes, in place, the geometry of Alaska &amp; Hawaii in the GeoDataFrame to be &quot;inset&quot;</span>
<span class="sd">    name is the column that contains the name of the state.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">scale_translate</span><span class="p">(</span><span class="n">state_name</span><span class="p">,</span> <span class="n">ratio</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)):</span>
        <span class="c1"># get the geometry and save the index value using the walrus operator</span>
        <span class="n">multi_poly</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">index</span><span class="o">:=</span><span class="n">gdf</span><span class="p">[</span><span class="n">gdf</span><span class="p">[</span><span class="n">name_col</span><span class="p">]</span> <span class="o">==</span> <span class="n">state_name</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="s1">&#39;geometry&#39;</span><span class="p">]</span>

        <span class="c1"># scale each polygon in the state&#39;s multi-polygon in both x &amp; y direction</span>
        <span class="n">multi_poly</span> <span class="o">=</span> <span class="n">MultiPolygon</span><span class="p">([</span><span class="n">scale</span><span class="p">(</span><span class="n">poly</span><span class="p">,</span> <span class="n">ratio</span><span class="p">,</span> <span class="n">ratio</span><span class="p">)</span> <span class="k">for</span> <span class="n">poly</span> <span class="ow">in</span> <span class="n">multi_poly</span><span class="p">])</span>
        <span class="c1"># move the state by the offset values</span>
        <span class="n">multi_poly</span> <span class="o">=</span> <span class="n">translate</span><span class="p">(</span><span class="n">multi_poly</span><span class="p">,</span> <span class="n">xoff</span><span class="o">=</span><span class="n">offset</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">yoff</span><span class="o">=</span><span class="n">offset</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="c1"># set the value using the &#39;at&#39; method because &#39;loc&#39; won&#39;t work</span>
        <span class="n">gdf</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;geometry&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">multi_poly</span>
        
    <span class="n">scale_translate</span><span class="p">(</span><span class="s1">&#39;Alaska&#39;</span><span class="p">,</span> <span class="n">ratio</span><span class="o">=</span><span class="mf">0.35</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="p">(</span><span class="mi">26</span><span class="p">,</span><span class="o">-</span><span class="mi">35</span><span class="p">))</span>
    <span class="n">scale_translate</span><span class="p">(</span><span class="s1">&#39;Hawaii&#39;</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="p">(</span><span class="mi">45</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">plot_votes</span><span class="p">(</span><span class="n">gdf</span><span class="p">):</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>

    <span class="c1"># Plot the entire United States</span>
    <span class="n">gdf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="s1">&#39;Electoral Votes&#39;</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># remove the box and the x,y ticks</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span> 

    <span class="c1"># Set the extent of the main plot to cut off Alaska&#39;s long tail of regions</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">130</span><span class="p">,</span> <span class="o">-</span><span class="mi">65</span><span class="p">)</span>
    <span class="c1"># without this limit, we get Alaska&#39;s tail looking like it&#39;s part of Hawaii</span>
    <span class="c1"># It&#39;s better just to eliminate that portion of the plot</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Electoral College Votes by State&#39;</span><span class="p">)</span>

<span class="c1"># Call the methods above to generate the plot using modified geometry</span>
<span class="n">modify_geometry</span><span class="p">(</span><span class="n">gdf</span><span class="p">)</span>
<span class="n">plot_votes</span><span class="p">(</span><span class="n">gdf</span><span class="p">)</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-6" name="sd-tab-set-1" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-6">
Data</label><div class="sd-tab-content docutils">
<p>This data is a merge of two different data sources: electoral_college.csv and a ShapeFile of the United States.  You‚Äôll note that in the code we were able to read column values <code class="docutils literal notranslate"><span class="pre">&quot;707,558&quot;</span></code> (a string with a literal comma as the thousands separator), by using the named parameter <code class="docutils literal notranslate"><span class="pre">thousands</span></code> in the <code class="docutils literal notranslate"><span class="pre">read_csv</span></code> call. Handy!! We also eliminated a duplicate column using <code class="docutils literal notranslate"><span class="pre">drop</span></code>.<br />
<img alt="election data" src="../_images/geo_elect_data.jpg" /></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">electoral</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;electoral_college.csv&#39;</span><span class="p">,</span> <span class="n">thousands</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
<span class="n">gdf</span> <span class="o">=</span> <span class="n">us_states</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">electoral</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;NAME&#39;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;State&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
<span class="n">gdf</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s1">&#39;State&#39;</span><span class="p">)</span> <span class="c1"># this is a duplicate of &#39;NAME&#39;</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-7" name="sd-tab-set-1" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-7">
Comments</label><div class="sd-tab-content docutils">
<p>When the geometry of the GeoDataFrame is modified, the plotting code is pretty simple and allows for further customizations without crazy code. A few points worthy of calling out:</p>
<ul class="simple">
<li><p>We use a <code class="docutils literal notranslate"><span class="pre">walrus</span></code> operator (<code class="docutils literal notranslate"><span class="pre">:=</span></code>) to assign a sub-expression to a variable in the middle of a larger expression. This allows us to reuse the value again later on in the code. It would have been just as easy to write it with two lines of code instead of one, but‚Ä¶ <em>Bragging Rights!</em></p></li>
<li><p>When modifying the GeoDataFrame, we used the <a href='https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.at.html' target='_blank'><code class="docutils literal notranslate"><span class="pre">at</span></code> method</a> instead of <code class="docutils literal notranslate"><span class="pre">loc</span></code>. Using loc results in an error: ‚ÄúValueError: Must have equal len keys and value when setting with an iterable‚Äù.</p></li>
</ul>
</div>
</div>
</section>
<section id="annotated-with-table-inset">
<h2>Annotated with Table Inset<a class="headerlink" href="#annotated-with-table-inset" title="Permalink to this heading">#</a></h2>
<p>The problem with the plot above is that it is very hard to see if there is any difference between Orgegon and Nevada; the colors are just too close! To fix that we will annotate each state with the count of the votes printed onto the state‚Äôs location.</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-8" name="sd-tab-set-2" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-8">
Image</label><div class="sd-tab-content docutils">
<p><img alt="election image" src="../_images/geo_elect_annotated.jpg" /></p>
</div>
<input id="sd-tab-item-9" name="sd-tab-set-2" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-9">
Code</label><div class="sd-tab-content docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
<span class="k">def</span> <span class="nf">annotate_states</span><span class="p">(</span><span class="n">gdf</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">value_col</span><span class="p">,</span> <span class="n">not_states</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name_col</span><span class="o">=</span><span class="s1">&#39;NAME&#39;</span><span class="p">):</span>
    <span class="c1"># annotate the states in the list, states, with values in col_name</span>
    <span class="c1"># Filter first so that we iterate through the rows that have the state name we want</span>
    <span class="n">gdf_states</span> <span class="o">=</span> <span class="n">gdf</span> <span class="k">if</span> <span class="n">not_states</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">gdf</span><span class="p">[</span><span class="o">~</span><span class="n">gdf</span><span class="p">[</span><span class="n">name_col</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">not_states</span><span class="p">)]</span>
    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">gdf_states</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="c1"># get the location of the state from the geometry</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">centroid</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">centroid</span><span class="o">.</span><span class="n">y</span>
        <span class="c1"># add the text with an xytext offset that seems right for our plots size</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:.0f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="n">value_col</span><span class="p">]),</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">textcoords</span><span class="o">=</span><span class="s1">&#39;offset points&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">add_table_inset</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="c1"># x, y, width, height as % of figure</span>
    <span class="n">ax_table</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">.77</span><span class="p">,</span> <span class="mf">.35</span><span class="p">,</span> <span class="mf">.15</span><span class="p">,</span> <span class="mf">.4</span><span class="p">])</span>
    <span class="n">ax_table</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
    <span class="n">table</span> <span class="o">=</span> <span class="n">ax_table</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="n">cellText</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">colLabels</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">cellLoc</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
    <span class="c1"># Adjust the font size of the table</span>
    <span class="n">table</span><span class="o">.</span><span class="n">auto_set_font_size</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">table</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">table</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">plot_annotated_votes</span><span class="p">(</span><span class="n">gdf</span><span class="p">):</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>

    <span class="c1"># Plot the entire United States</span>
    <span class="c1"># Choose the &#39;cool&#39; colormap so the black text appears nicely</span>
    <span class="n">gdf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="s1">&#39;Electoral Votes&#39;</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;cool&#39;</span><span class="p">,</span> 
             <span class="n">legend_kwds</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;orientation&#39;</span><span class="p">:</span><span class="s1">&#39;horizontal&#39;</span><span class="p">},</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;lightgray&#39;</span><span class="p">)</span>
    <span class="c1"># remove the box and the x,y ticks</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span> 

    <span class="c1"># Set the extent of the main plot to cut off Alaska&#39;s long tail of regions</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">130</span><span class="p">,</span> <span class="o">-</span><span class="mi">65</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Electoral College Votes by State&#39;</span><span class="p">)</span>
    
    <span class="n">small</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;District of Columbia&#39;</span><span class="p">,</span> <span class="s1">&#39;Rhode Island&#39;</span><span class="p">,</span> <span class="s1">&#39;New Jersey&#39;</span><span class="p">,</span> <span class="s1">&#39;Delaware&#39;</span><span class="p">,</span> <span class="s1">&#39;Vermont&#39;</span><span class="p">,</span> <span class="s1">&#39;New Hampshire&#39;</span><span class="p">,</span> <span class="s1">&#39;Connecticut&#39;</span><span class="p">]</span>
    <span class="n">annotate_states</span><span class="p">(</span><span class="n">gdf</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="s1">&#39;Electoral Votes&#39;</span><span class="p">,</span> <span class="n">not_states</span><span class="o">=</span><span class="n">small</span><span class="p">)</span>
    
    <span class="c1"># Before we can show our table, we need a DataFrame the data.</span>
    <span class="c1"># Create the data of integer values of the smaller states, sorted by state name, with abbreviations</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">gdf</span><span class="p">[</span><span class="n">gdf</span><span class="p">[</span><span class="s1">&#39;NAME&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">small</span><span class="p">)]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;NAME&#39;</span><span class="p">)</span>
    <span class="n">d</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;State&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;CN&#39;</span><span class="p">,</span> <span class="s1">&#39;DE&#39;</span><span class="p">,</span> <span class="s1">&#39;DC&#39;</span><span class="p">,</span> <span class="s1">&#39;NH&#39;</span><span class="p">,</span> <span class="s1">&#39;NJ&#39;</span><span class="p">,</span> <span class="s1">&#39;RI&#39;</span><span class="p">,</span> <span class="s1">&#39;VT&#39;</span><span class="p">],</span>
          <span class="s1">&#39;Votes&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Electoral Votes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">)))</span> <span class="p">}</span>
    
    <span class="c1"># show a table of the values for the smaller states</span>
    <span class="n">add_table_inset</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">d</span><span class="p">))</span>
    
<span class="c1"># Be sure we have our modified geometry before calling the code above</span>
<span class="n">modify_geometry</span><span class="p">(</span><span class="n">gdf</span><span class="p">)</span>
<span class="n">plot_annotated_votes</span><span class="p">(</span><span class="n">gdf</span><span class="p">)</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-10" name="sd-tab-set-2" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-10">
Data</label><div class="sd-tab-content docutils">
<p>This data is a merge of two different data sources: electoral_college.csv and a ShapeFile of the United States.  You‚Äôll note that in the code we were able to read column values <code class="docutils literal notranslate"><span class="pre">&quot;707,558&quot;</span></code> (a string with a literal comma as the thousands separator), by using the named parameter <code class="docutils literal notranslate"><span class="pre">thousands</span></code> in the <code class="docutils literal notranslate"><span class="pre">read_csv</span></code> call. Handy!! We also eliminated a duplicate column using <code class="docutils literal notranslate"><span class="pre">drop</span></code>.<br />
<img alt="election data" src="../_images/geo_elect_data.jpg" /></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">electoral</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;electoral_college.csv&#39;</span><span class="p">,</span> <span class="n">thousands</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
<span class="n">gdf</span> <span class="o">=</span> <span class="n">us_states</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">electoral</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;NAME&#39;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;State&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
<span class="n">gdf</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s1">&#39;State&#39;</span><span class="p">)</span> <span class="c1"># this is a duplicate of &#39;NAME&#39;</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-11" name="sd-tab-set-2" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-11">
Comments</label><div class="sd-tab-content docutils">
<p>We moved the legend to be horizontal, not because it was necessary, but because we can. This was accomplished by using the <code class="docutils literal notranslate"><span class="pre">legend_kwds</span></code> argument in the plot method. There are other ways to do this (as always).</p>
<p>There are several issues that we address in this plotting solution:</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Problem</p></th>
<th class="head"><p>Fix</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>The black text doesn‚Äôt show up well with the default colormap.</p></td>
<td><p>Change the <code class="docutils literal notranslate"><span class="pre">colormap</span></code> to ‚Äòcool‚Äô.</p></td>
</tr>
<tr class="row-odd"><td><p>The smaller states don‚Äôt have room for the text. It all gets printed on top of each other and is unreadable.</p></td>
<td><p>Avoid annotating values on the states with a small geometry. We just manually do this, however, we could have used the ‚ÄòCENSUSAREA‚Äô column to help us out with that. Doing it explicitly is good enough for us.</p></td>
</tr>
<tr class="row-even"><td><p>The smaller states‚Äô values get lost when not shown!</p></td>
<td><p>Create an inset table that displays the values</p></td>
</tr>
<tr class="row-odd"><td><p>The dataframe of values is floating point</p></td>
<td><p>Use the apply method and a lambda to convert all the values to integer. There is probably another way‚Ä¶ there always is!</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="finding-obvious-correlations">
<h2>Finding Obvious Correlations<a class="headerlink" href="#finding-obvious-correlations" title="Permalink to this heading">#</a></h2>
<p>Is there a correlation between population and electoral votes? Does the size of a state in square miles correlate to the number of electoral votes? Geospatial provides only minimal insight; a scatter plot is better.</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-12" name="sd-tab-set-3" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-12">
Image</label><div class="sd-tab-content docutils">
<p>One the top-left, you‚Äôll see a plot representing Electoral Votes by state. Were we to plot a geospatial plot of Population, we‚Äôd see something virtually identical and therefore a correrlation would be seen.<br />
One the top-right, you‚Äôll see a plot representing each state‚Äôs size in square miles.</p>
<p><img alt="election image" src="../_images/geo_correlation.jpg" /></p>
</div>
<input id="sd-tab-item-13" name="sd-tab-set-3" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-13">
Code</label><div class="sd-tab-content docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_correlation</span><span class="p">(</span><span class="n">gdf</span><span class="p">):</span>
    <span class="n">fig</span><span class="p">,</span> <span class="p">((</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">),</span> <span class="p">(</span><span class="n">ax3</span><span class="p">,</span> <span class="n">ax4</span><span class="p">))</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>

    <span class="c1"># Plot the entire United States</span>
    <span class="n">gdf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="s1">&#39;Electoral Votes&#39;</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">gdf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="s1">&#39;CENSUSAREA&#39;</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># Set the extent of the main plot to cut off Alaska&#39;s long tail of regions</span>
    <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">130</span><span class="p">,</span> <span class="o">-</span><span class="mi">65</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Electoral Votes&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Square Miles&#39;</span><span class="p">)</span>
    <span class="n">gdf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax4</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;scatter&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Electoral Votes&#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;CENSUSAREA&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">)</span>
    <span class="n">gdf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax3</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;scatter&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Electoral Votes&#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;2023 Population&#39;</span><span class="p">)</span>
    <span class="n">ax4</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Area vs Votes&#39;</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Population vs Votes&#39;</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="p">(</span><span class="n">ax3</span><span class="p">,</span> <span class="n">ax4</span><span class="p">):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;.25&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-14" name="sd-tab-set-3" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-14">
Data</label><div class="sd-tab-content docutils">
<p>Same data as above.<br />
<img alt="election data" src="../_images/geo_elect_data.jpg" /></p>
</div>
<input id="sd-tab-item-15" name="sd-tab-set-3" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-15">
Comments</label><div class="sd-tab-content docutils">
<p>Were we to plot a geospatial plot of Population, we‚Äôd see something virtually identical to the top-left and, therefore, a correrlation would be seen. But, it would take <strong>two</strong> geospatial plots to show the correlation. And, in this specific case, the correlation is <strong>extremely strong</strong>; Electoral Votes is, in fact, calculated by a state‚Äôs population. In this example, we omitted the second geospatial plot in favor of a scatter plot.</p>
<p>One the top-right, you‚Äôll see a plot representing each state‚Äôs size in square miles. Is there a correlation of a state‚Äôs size to the count of Electoral Votes? It‚Äôs a bit hard to determine from the geospatial plot. However, in combination with the scatter plots, one can be more confident in their assessment.</p>
<p><strong>In summary</strong>: we show 4 different plots in a single figure that in combination provide insight. The geospatial plots provide some understanding about where the Electoral Votes go geographically. Showing it side-by-side to the geospatial plot on Square Miles gives you an idea that there is <em>not an obvious</em> correlation between votes and square miles. However, when we add the scatter plots, the correlations become a lot clearer. It is obvious that there is strong and direct relationship between population and votes, while there is very little, if any, correlation of square miles to votes.</p>
<div class="dropdown admonition">
<p class="admonition-title">Using Statistics</p>
<p>In other sections, you can see how using Python libraries you can identify statistical information (e.g. Coefficient of Determination, Mean Square Error) to provide objective measurements of the correlation. In our example here, the Coefficient of Determination (<span class="math notranslate nohighlight">\(R^2\)</span>) for Votes vs Area is only 0.019 (which is extremely small) while for Votes vs Population the value is 0.991 (which is extremely high).</p>
</div>
</div>
</div>
</section>
<section id="correlations-and-coefficient-of-determination">
<h2>Correlations and Coefficient of Determination<a class="headerlink" href="#correlations-and-coefficient-of-determination" title="Permalink to this heading">#</a></h2>
<p>In this example, we create three values (A, B, C) for each state. There is a strong correlation in the data, but the geospatial plots makes it hard to see <strong>how</strong> they relate. See if you can spot the correlations in the geospatial plots? Notice how the plots for <strong>‚ÄòValue A‚Äô</strong> and <strong>‚ÄòValue C‚Äô</strong> appear to be nearly identical, yet the details of the relationship is somewhat hidden because of the scale on the colormap. Then, the scatter &amp; line plots make it all very apparent. Read more in the <strong>Plot Comments</strong> and <strong>Code Comments</strong> tabs.</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-16" name="sd-tab-set-4" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-16">
Image</label><div class="sd-tab-content docutils">
<p><img alt="Geospacial &amp; Linear plots" src="../_images/geo_line_correlations.jpg" /></p>
</div>
<input id="sd-tab-item-17" name="sd-tab-set-4" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-17">
Code</label><div class="sd-tab-content docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>

<span class="k">def</span> <span class="nf">plot_correlations</span><span class="p">(</span><span class="n">gdf</span><span class="p">):</span>
    <span class="c1"># sort along the x-axis to make line look like a line</span>
    <span class="n">gdf</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;A&#39;</span><span class="p">)</span>
    <span class="n">res_b</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">linregress</span><span class="p">(</span><span class="n">gdf</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">],</span> <span class="n">gdf</span><span class="p">[</span><span class="s1">&#39;B&#39;</span><span class="p">])</span>
    <span class="n">res_c</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">linregress</span><span class="p">(</span><span class="n">gdf</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">],</span> <span class="n">gdf</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">])</span>
    
    <span class="n">fig</span><span class="p">,</span> <span class="p">((</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">),</span> <span class="p">(</span><span class="n">ax3</span><span class="p">,</span> <span class="n">ax4</span><span class="p">),</span> <span class="p">(</span><span class="n">ax5</span><span class="p">,</span> <span class="n">ax6</span><span class="p">),</span> <span class="p">(</span><span class="n">ax7</span><span class="p">,</span> <span class="n">ax8</span><span class="p">))</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">15</span><span class="p">))</span>

    <span class="c1"># the linear plots are virtually on top of each other. Spread them out</span>
    <span class="c1"># horizontally even though this makes the geospatial plots seem too var apart.</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="n">max_value</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">gdf</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">gdf</span><span class="p">[</span><span class="s1">&#39;B&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">gdf</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
    
    <span class="c1"># Plot A, B, C values for the entire United States</span>
    <span class="n">gdf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">gdf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">max_value</span><span class="p">)</span>
    <span class="n">gdf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax3</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">gdf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax4</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">max_value</span><span class="p">)</span>
    <span class="n">gdf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax5</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">max_value</span><span class="p">)</span>
    <span class="n">axes</span> <span class="o">=</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span><span class="p">,</span> <span class="n">ax4</span><span class="p">,</span> <span class="n">ax5</span><span class="p">)</span>
    <span class="c1"># Set the extent of the main plot to cut off Alaska&#39;s long tail of regions</span>
    <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">130</span><span class="p">,</span> <span class="o">-</span><span class="mi">65</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Value A&#39;</span><span class="p">,</span> <span class="s1">&#39;Value B&#39;</span><span class="p">,</span> <span class="s1">&#39;Value C&#39;</span><span class="p">,</span> <span class="s1">&#39;Value A (on B scale)&#39;</span><span class="p">,</span> <span class="s1">&#39;Value C (on B scale)&#39;</span><span class="p">]):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    
    <span class="c1"># create the scatter plots</span>
    <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="p">(</span><span class="n">ax6</span><span class="p">,</span> <span class="n">ax8</span><span class="p">):</span>
        <span class="n">gdf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;scatter&#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;B Value&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="p">(</span><span class="n">ax7</span><span class="p">,</span> <span class="n">ax8</span><span class="p">):</span>
        <span class="n">gdf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;scatter&#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;C Value&#39;</span><span class="p">)</span>
    
    <span class="c1"># create a DataFrame with best fit line data</span>
    <span class="n">line</span> <span class="o">=</span> <span class="n">gdf</span><span class="p">[[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">line</span><span class="p">[</span><span class="s1">&#39;YB&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">res_b</span><span class="o">.</span><span class="n">intercept</span> <span class="o">+</span> <span class="n">res_b</span><span class="o">.</span><span class="n">slope</span><span class="o">*</span><span class="n">line</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span>
    <span class="n">line</span><span class="p">[</span><span class="s1">&#39;YC&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">res_c</span><span class="o">.</span><span class="n">intercept</span> <span class="o">+</span> <span class="n">res_c</span><span class="o">.</span><span class="n">slope</span><span class="o">*</span><span class="n">line</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span>
    
    <span class="c1"># plot best fit lines</span>
    <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="p">(</span><span class="n">ax6</span><span class="p">,</span> <span class="n">ax8</span><span class="p">):</span>
        <span class="n">line</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;line&#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;YB&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;B fitted line&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="p">(</span><span class="n">ax7</span><span class="p">,</span> <span class="n">ax8</span><span class="p">):</span>
        <span class="n">line</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;line&#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;YC&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;C fitted line&#39;</span><span class="p">)</span>
    
    <span class="c1"># print the Coefficient of Determination onto the plots</span>
    <span class="n">ax6</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">70</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;R2=</span><span class="si">{</span><span class="n">res_b</span><span class="o">.</span><span class="n">rvalue</span><span class="o">**</span><span class="mi">2</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">ax7</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">70</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;R2=</span><span class="si">{</span><span class="n">res_c</span><span class="o">.</span><span class="n">rvalue</span><span class="o">**</span><span class="mi">2</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">ax8</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">70</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;B R2=</span><span class="si">{</span><span class="n">res_b</span><span class="o">.</span><span class="n">rvalue</span><span class="o">**</span><span class="mi">2</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="se">\n</span><span class="s1">C R2=</span><span class="si">{</span><span class="n">res_c</span><span class="o">.</span><span class="n">rvalue</span><span class="o">**</span><span class="mi">2</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">ax6</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Value B vs Value A&#39;</span><span class="p">)</span>
    <span class="n">ax7</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Value C vs Value A&#39;</span><span class="p">)</span>
    <span class="n">ax8</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;B &amp; C vs Value A&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-18" name="sd-tab-set-4" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-18">
Data</label><div class="sd-tab-content docutils">
<p>The values for A, B, and C are contrived. This is only the first 12 rows of the full set.<br />
<img alt="election data" src="../_images/geo_abc_data.jpg" /></p>
</div>
<input id="sd-tab-item-19" name="sd-tab-set-4" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-19">
Plot Comments</label><div class="sd-tab-content docutils">
<p>There is a lot going on here. First, let‚Äôs discuss the geospatial plots. There appears to be some correlation
in all the geospatial plots, but it is hard to figure out. One might think that <strong>Value A</strong> and <strong>Value C</strong> are identical.
However, when we plot A, B, C all on the same color scale, you can see that <strong>Value A (on B scale)</strong> is quite different
from <strong>Value C (on B scale)</strong>. Can you see the relationship between <strong>Value A</strong> and <strong>Value B</strong>? I think you
can see that there is <em>some</em> relationship, but it is hard to understand what it is and how strong it is.</p>
<p>Now, let‚Äôs look at the scatter and line plots. The dots alone shows a clear linear relationship. When we
add the line, the correlation is bolstered.</p>
<p>But, how strong is the correlation? To determine this, we displayed the <strong>Coefficient of Determination</strong> value
on the plot directly. The larger the value (closer to 1.0), the strong the correlation. The <span class="math notranslate nohighlight">\(R^2\)</span> value basically
tells us what percentage of the value on the y-axis is due to the value on the x-axis. We see that the values of
<span class="math notranslate nohighlight">\(R^2\)</span> are 0.736 and 0.948 respectively. These are quite high.</p>
<p>Lastly, the best plot is the last one which combines all the information into a single plot. If you‚Äôre trying
to show correlation with <strong>Value A</strong>, the last plot is all you need.</p>
</div>
<input id="sd-tab-item-20" name="sd-tab-set-4" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-20">
Code Comments</label><div class="sd-tab-content docutils">
<p>In this plot, we generated the line using the method <code class="docutils literal notranslate"><span class="pre">stats</span></code> that we imported with: <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">scipy</span> <span class="pre">import</span> <span class="pre">stats</span></code>.
We calculated the slope and y-intercept from the data points and used that to plot the line. It was critically
important to first sort the values by the x-axis (in our case, by <strong>Value A</strong>).</p>
<p>We could have generated the line in the plot using <code class="docutils literal notranslate"><span class="pre">seaborn.regplot</span></code>. While this would have drawn our line
for us automatically, it does not provide the <strong>Coefficient of Determination</strong>. So, instead, we get all
the <strong>Line of Best Fit</strong> information using <code class="docutils literal notranslate"><span class="pre">stats.linregress</span></code>.</p>
<p>To present the <span class="math notranslate nohighlight">\(R^2\)</span> value on the plot, we need to choose where to ‚Äúprint‚Äù it using the <code class="docutils literal notranslate"><span class="pre">ax.text</span></code> method.
To accomplish this, we plotted the graph with the text first, identified an open space, and then added
the printing code. The <span class="math notranslate nohighlight">\(R^2\)</span> value is a lot of digits after the decimal place that just get in the way. We choose to print the value
using Python‚Äôs string <a href="https://docs.python.org/3/library/string.html#format-string-syntax" 
target="_blank">formatting</a> functionality as built into Pythons <a href="https://realpython.com/python-f-strings/" 
target="_blank">f-string</a>. The API is a bit complicated to understand. It is similar
to the way Java implements <code class="docutils literal notranslate"><span class="pre">printf</span></code>, only it has different escape sequences and specifics. In short, when a
string literal is preceded with ‚Äòf‚Äô then the string is expecting to have some
formatting sequence in it. A formatting sequence is embedded inside curly braces <code class="docutils literal notranslate"><span class="pre">{}</span></code> and the text
inside the curly braces is interpreted. It would contain identifiers, method calls, and possibly
formatting options following a colon. Here is the syantax for printing a floating point number with some text label:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>f&#39;text{&lt;identifer&gt;:.&lt;integer&gt;f}&#39;
</pre></div>
</div>
<p>For example, let‚Äôs say we do the following:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>gpa = 3.899
print(f&#39;GPA={gpa:.2f}&#39;)
</pre></div>
</div>
<p>That code results in printing, <code class="docutils literal notranslate"><span class="pre">GPA=3.90</span></code> (due to rounding to 2 decimal places).</p>
<p>To set the color scales to match in each of the geospatial plots, we set both <code class="docutils literal notranslate"><span class="pre">vmin</span></code> and <code class="docutils literal notranslate"><span class="pre">vmax</span></code>. When we
don‚Äôt set these, the plot will customize the colors to match the data being plotted. This is often what you
want to do, but if you‚Äôre attempting to see a relationship between two geospatial plots, setting vmin and
vmax are important.</p>
<p>The vertical spacing between the all the plots was originally not good enough. The line plots had their
x-axis‚Äô labels occluded by the titles of the graphs below them. So, we added vertical spacing with
<code class="docutils literal notranslate"><span class="pre">plt.subplots_adjust(hspace=0.3)</span></code>. This actually makes the spacing be too large in the geospatial plots.
We could have customized the spacing across all the subplots by using <a href="https://matplotlib.org/stable/gallery/userdemo/demo_gridspec03.html" target="_blank">matplotlib GridSpec</a>. But, since that code is pretty foreign and not
at all the focus of this discussion, we left the spacing as-is.</p>
</div>
</div>
</section>
<section id="cartopy">
<h2>Cartopy<a class="headerlink" href="#cartopy" title="Permalink to this heading">#</a></h2>
<p>You can make some cool plots that show the terrain of the Earth using a libary called <code class="docutils literal notranslate"><span class="pre">cartopy</span></code>.
These types of plots are good to use when you‚Äôre attempting to illustrate the location of something
as it would appear on a map.</p>
<p>Advantages:</p>
<ul class="simple">
<li><p>No need to manually download shape files. The library will download data for you.</p></li>
<li><p>The plots are professional looking.</p></li>
</ul>
<p>Disadvantages:</p>
<ul class="simple">
<li><p>Does not work on Replit</p></li>
<li><p>Requires some background knowledge about different types of Coordinate and Projection systems.</p></li>
</ul>
<p>You can still do some geodataframe-looking plots. For example, the <a href="https://cse163.github.io/book/module-7-geospatial-data/lesson-20-dissolve-join/hurricane-florence/HurricanFlorence.html" target="_blank">
Hurricane Florence plot</a> is replicated on Hurricane Katrina using <a href="https://scitools.org.uk/cartopy/docs/latest/gallery/lines_and_polygons/hurricane_katrina.html#sphx-glr-gallery-lines-and-polygons-hurricane-katrina-py" target="_blank">this code</a>.</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-21" name="sd-tab-set-5" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-21">
Image</label><div class="sd-tab-content docutils">
<p>This shows a direct, ‚Äúflat‚Äù  Plate Carr√©e line between Seattle and New York as well as the curved, Geodetic line
that an airplane would travel over the curved Earth, which is a more accurate reflection of reality.</p>
<p><img alt="election image" src="../_images/geo_cartopy.jpg" /></p>
</div>
<input id="sd-tab-item-22" name="sd-tab-set-5" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-22">
Code</label><div class="sd-tab-content docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">cartopy.crs</span> <span class="k">as</span> <span class="nn">ccrs</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">cartopy.feature</span> <span class="k">as</span> <span class="nn">cfeature</span>

<span class="k">def</span> <span class="nf">cartopy_plot_of_us</span><span class="p">():</span>
    <span class="c1"># create a figure &amp; axis using the Robinson projection.</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">subplot_kw</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;projection&#39;</span><span class="p">:</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">Robinson</span><span class="p">()},</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>

    <span class="c1"># show some texture &amp; color on the map representing the terrain</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">stock_img</span><span class="p">()</span>

    <span class="c1"># crop the figure to be just the United States</span>
    <span class="c1"># if we don&#39;t set_extent, the image is too big to be displayed (in Jupyter Notebook)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_extent</span><span class="p">([</span><span class="o">-</span><span class="mi">130</span><span class="p">,</span> <span class="o">-</span><span class="mi">60</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">50</span><span class="p">],</span> <span class="n">crs</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>

    <span class="c1"># set the latitude and longitude points for Seattle &amp; New york</span>
    <span class="n">ny_lat</span><span class="p">,</span> <span class="n">ny_lon</span> <span class="o">=</span> <span class="mf">40.73</span><span class="p">,</span> <span class="o">-</span><span class="mf">73.93</span>
    <span class="n">sea_lat</span><span class="p">,</span> <span class="n">sea_lon</span> <span class="o">=</span> <span class="mf">47.60</span><span class="p">,</span> <span class="o">-</span><span class="mf">122.33</span>

    <span class="c1"># draw a line using Geodetic() to give it a curved look over a curved Earth</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">ny_lon</span><span class="p">,</span> <span class="n">sea_lon</span><span class="p">],</span> <span class="p">[</span><span class="n">ny_lat</span><span class="p">,</span> <span class="n">sea_lat</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span>
             <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">Geodetic</span><span class="p">())</span>

    <span class="c1"># draw a line using PlateCarree() which assume a flat, paper-like map</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">ny_lon</span><span class="p">,</span> <span class="n">sea_lon</span><span class="p">],</span> <span class="p">[</span><span class="n">ny_lat</span><span class="p">,</span> <span class="n">sea_lat</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span>
             <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>

    <span class="c1"># annotate the map with text of cities</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">ny_lon</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="n">ny_lat</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;New York&#39;</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">Geodetic</span><span class="p">())</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">sea_lon</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">sea_lat</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Seattle&#39;</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">Geodetic</span><span class="p">())</span>

    <span class="c1"># Show some features and borders</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">COASTLINE</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">STATES</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">BORDERS</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">LAKES</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">RIVERS</span><span class="p">)</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-23" name="sd-tab-set-5" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-23">
Data</label><div class="sd-tab-content docutils">
<p>All the data is downloaded directly by the Cartopy library.</p>
</div>
<input id="sd-tab-item-24" name="sd-tab-set-5" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-24">
Comments</label><div class="sd-tab-content docutils">
<p>The <a href="https://scitools.org.uk/cartopy/docs/latest/reference/projections.html" target="_blank">Projection types</a> are many. One popular projection is: <code class="docutils literal notranslate"><span class="pre">ccrs.PlateCarree()</span></code>.</p>
<p>In this plot, we add the ‚Äústock image‚Äù of the background (textured map) to the axis. We then plot two lines onto the map using two different projection systems.  We add text labels for the city names. Lastly, we add nice features such as state borders, lakes, and rivers.</p>
<p>We need to know the latitude &amp; longitude positions of the two cities. Other than that, our data is virtually non-existent.</p>
<p>There is a lot to know about <a href="https://scitools.org.uk/cartopy/docs/latest/getting_started/index.html" target="_blank">Cartopy</a>. It can take a lot of time to learn (as with every library). So, be sure this library adds value and is appropriate for your task before you simply start using it.</p>
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./visualizations"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="barchart.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Bar Charts</p>
      </div>
    </a>
    <a class="right-next"
       href="lineplots.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Line Plots &amp; Scatter Plots</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#contiguous-states-only">Contiguous States Only</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#inset-alaska-hawaii">Inset Alaska &amp; Hawaii</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modified-geometry">Modified Geometry</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#annotated-with-table-inset">Annotated with Table Inset</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#finding-obvious-correlations">Finding Obvious Correlations</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#correlations-and-coefficient-of-determination">Correlations and Coefficient of Determination</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#cartopy">Cartopy</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Jeff Stride
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      ¬© Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
<div class="extra_footer">
  <a href="https://idp.mrstride.com/acknowledgements.html">Acknowledgements</a>
</div>
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>